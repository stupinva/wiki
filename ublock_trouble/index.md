Забавная проблема с uBlock Origin
=================================

Описывал в своей wiki-системе Ikiwiki её плагин под названием `pagestats`. Сделал снимок фрагмента страницы и приложил его к статье. Но на странице эта картинка упорно не хотела отображаться. Проверил, что картинка находится, где положено и успешно отображается в браузере. Заглянул в исходный текст на веб-сервере страницы и не нашёл проблем. Потом посмотрел в исходный текст страницы в отладчике браузера Firefox, которым пользуюсь, и заметил в конце тега `img` странное свойство с именем, состоящим из случайных символов:

[[firefox_bug.png]]

Попробовал очистить кэш браузера и обновить страницу, но и это не помогло.

Установил Chromium, чтобы проверить, как отображается страница там. На работе у меня уже периодически возникали проблемы с отображением страниц в Firefox и я подумал, что если и эта будет нормально отображаться в Chromium, то придётся распрощаться с Firefox и пользоваться Chromium, как подавляющее большинство других интернет-пользователей.

Каково же было моё удивление, когда в Chromium повторилась та же самая проблема! Картинку точно так же можно было открыть по ссылке, но нельзя увидеть на странице, а в конце тега `img` опять появлялось свойство, состоящее из случайных символов:

[[chromium_bug.png]]

Не может быть, чтобы два разных браузера имели одну и ту же ошибку. Я попробовал скачать страницу с помощью `curl`, подозревая, что источником проблем могли быть вызваны `nginx` или `mathopd`, которые по какой-то неведомой причине, вдруг, могли вносить искажения в раздаваемые статические HTML-файлы. Это подозрение было весьма маловероятным и не оправдалось, со страницей всё было в порядке и после её прохождения через веб-серверы:

[[curl.png]]

Я заподозрил, что источником проблемы является дополнение uBlock Origin, которое установлено в обоих браузерах. Попробовал отключить его в Firefox и увидел, что картинка появилась на странице. Стал проверять догадку через журнал работы uBlock Origin и не ошибся, картинка действительно блокировалась:

[[ublock_logger.png]]

[[ublock_rule.png]]

К счастью, над правилом разблокировки долго думать не пришлось. Достаточно перейти во вкладку "Стат. фильтр", поменять в выпадающем списке действие "Блокировать" на "Разрешить" и проблема решена!

[[ublock_unblock.png]]

Вся эта история приключилась ровно потому, что название плагина `pagestats` совпало с названием файлов, ссылки на которые добавляются на страницы для сбора статистики их посещения, а в uBlock Origin обращения к таким файлам оказались заблокированными. А ведь Firefox был на волосок от смерти. Если бы в Chromium не был установлен uBlock Origin, то его репутация была бы подмочена, а участь предрешена :)
