Перенос приложений и данных LineageOS на новое устройство
=========================================================

[[!tag android lineageos adb backup]]

Подготовка устройства
---------------------

Сначала нужно открыть "Настройки", выбрать пункт меню "О телефоне" и на открывшемся экране семь раз нажать на текст "Номер сборки".

Снова открываем "Настройки", переходим в пункт меню "Система", переходим в пункт меню "Для разработчиков", который должен появиться после описанных выше действий, и включаем опции "Отладка по USB" и "Отладка суперпользователем".

Для съёма резервной копии и её восстановления нам понадобится персональный компьютер с операционной системой Linux и USB-кабель. Подсоединяем устройство к компьютеру с помощью USB-кабеля.

Подготовка компьютера
---------------------

На компьютере с Linux нужно установить пакет с утилитой `adb`. Я использую операционную систему Debian GNU/Linux, в ней это можно сделать следующим образом:

    # apt-get install adb

Для съёма резервной копии и её восстановления по мотивам статьи Марко Балмера [[Перенос данных и приложений на новое устройство с помощью adb (LineageOS 17)|lineageos17_migration]] я написал скрипт [[migrate.sh]]. Скачайте скрипт и разрешите запускать скрипт:

   $ chmod +x migrate.sh

Также нужно открыть скрипт и отредактировать значение переменной `BACKUPDIR`, присвоив ей путь к каталогу, который будет использоваться для сохранения резервной копии и в качестве источника данных для восстановления.

Съём и восстановление резервной копии
-------------------------------------

Для снятия резервной копии со старого устройства подключаем его к компьютеру и выполняем скрипт с аргументом `backup`:

    $ ./migrate.sh backup

Стоит отметить, что резервное копирование может прерваться, если в процессе копирования из внутреннего хранилища пропадёт один из файлов. Я столкнулся с тем, что в процессе резервного копирования Telegram удалял файлы из своего кэша. Чтобы Telegram не мешал резервному копированию, я временно остановил его следующим образом. Открыл "Настройки", затем выбрал пункт меню "Приложения", выбрал Telegram в списке недавно открывавшихся приложений. Если Telegram нет в списке недавно октрывавшихся приложений, то выбираем "Показать все приложения" и выбираем Telegram из открывшегося списка. На открывшемся экране "О приложении" нажимаем значок "Остановить" в виде восклицательного знака в треугольнике.

Для восстановления резервной копии на новое устройство подключаем его к компьютеру и выполняем скрипт с аргументом `restore`:

    $ ./migrate.sh restore

Тут тоже стоит отметить, что действия, описанные в разделе "Подготовка устройства" выше, следует проделать и с новым устройством тоже.

Проблемы
--------

У автора исходной статьи не получилось восстановить настройки трёх приложений:

- Signal
- Briar
- Protonmail

Я не пользуюсь ни одним из этих приложений, однако с проблемами восстановления данных столкнулся и я. У меня не восстановились настройки и данные следующих приложений:

- Telegram
- Firefox
- SMS/MMS

Также лишь частично восстановились будильники. Хорошо, что переносом данных я занимался в субботу и не сработавший в воскресенье будильник не привёл к опозданию на работу :)

Кроме этого не восстановились такие мелочи как обои и расположение значков, но это пустяки.
