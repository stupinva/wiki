Изменение размера диска в Linux
===============================

[[!tag lvm gpt mbr resize2fs]]

Изменение размера логического тома LVM
--------------------------------------

Для изменения размера логического тома можно воспользоваться командой следующего вида:

    # lvresize -L256G /dev/vg0/backup

В команде `vg0` - имя группы томов, `backup` - имя логического тома, `256G` - новый размер логического тома.

После изменения размера логического тома можно переходить к изменению размера файловой системы.

Изменение таблицы GPT
---------------------

После изменения размера диска нужно перенести хвост таблицы GPT в конец диска. Для этого можно воспользоваться утилитой `gdisk`:

    # gdisk /dev/sdd
    GPT fdisk (gdisk) version 1.0.1
    
    Partition table scan:
      MBR: protective
      BSD: not present
      APM: not present
      GPT: present
    
    Found valid GPT with protective MBR; using GPT.

Переходим в режим дополнительных функций:
    
    Command (? for help): x

Вводим команду для перемещения хвоста таблицы GPT в конец диска:

    Expert command (? for help): e
    Relocating backup data structures to the end of the disk


Записываем изменения на диск:

    Expert command (? for help): w
    
    Final checks complete. About to write GPT data. THIS WILL OVERWRITE EXISTING
    PARTITIONS!!

Соглашаемся на выполнение потенциально опасной операции:

    Do you want to proceed? (Y/N): Y
    OK; writing new GUID partition table (GPT) to /dev/sdd.
    Warning: The kernel is still using the old partition table.
    The new table will be used at the next reboot or after you
    run partprobe(8) or kpartx(8)
    The operation has completed successfully.

Изменение размера или расположение раздела в таблице MBR или GPT
----------------------------------------------------------------

Для изменения размера единственного раздела в таблице воспользуемся утилитой `sfdisk`. Если на диске есть несколько разделов, то этот способ пригоден только для изменения размера раздела, примыкающего к свободной области в конце диска.

Сначала сохраним имеющуюся структуру разделов на диске:

    # sfdisk --dump /dev/sdd > /root/sdd

Открываем файл `/root/sdd` в текстовом редакторе, находим строчку `last-lba`. Из значения этой строчки вычитаем значение `start` в строчке с описанием последнего раздела на диске. Получившееся значение вписываем в поле `size` в описании этого же последнего раздела на диске.

Теперь запишем на диск новую структуру разделов:

    # sfdisk -f /dev/sdd < /root/sdd

Теперь воспользуемся утилитой `partprobe` из пакета `parted` для того, чтобы сообщить операционной системе об изменении структуры разделов на диске:

    # partprobe

Изменение размера файловой системы ext2fs/ext3fs/ext4fs
-------------------------------------------------------

После изменения размер раздела нужно поменять размер файловой системы, находящейся в разделе диска. В случае с ext2fs/ext3fs/ext4fs сделать это можно при помощи утилиты `resize2fs` налету без необходимости перемонтирования. Для того, чтобы расширить файловую систему до размеров раздела, на котором она расположена, достаточно воспользоваться простой командой:

    # resize2fs /dev/sdd1
