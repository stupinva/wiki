После обновления операционной системы Debian
============================================

Если установлен сервер MySQL, на всякий случай стоит выполнить принудительное обновление структуры таблиц:

    $ mysql_upgrade --force -uroot -p

Если установлен PostgreSQL, то можно обновить кластер PostgreSQL до новой версии можно, руководствуясь инструкцией "Обновление PostgreSQL до нового релиза" на странице [[Советы и рецепты PostgreSQL|postgresql]].

Как правило, после обновления в системе остаются установленными пакеты из прошлых релизов, которых нет в новом релизе. Чтобы увидеть такие пакеты и удалить их, можно установить утилиту `apt-show-versions`:

    # apt-get install apt-show-versions

Посмотреть список установленных пакетов, которых нет в репозиториях, можно при помощи следующего конвейера:

    # apt-show-versions | awk -F: '/No available version in archive/ { print $1; }'

Удалить эти пакеты вместе с конфигурационными файлами можно при помощи такого конвейера:

    # apt-show-versions | awk -F: '/No available version in archive/ { print $1; }' | xargs apt-get purge -y

Выполнять эту команду лучше всего после перезагрузки системы, когда ядро операционной системы из нового релиза уже используется и старое ядро можно безопасно удалить.

Кроме пакетов без репозиториев в системе могут присутствовать пакеты-библиотеки, которые более не нужны ни одному другому установленному в системе пакету. Удалить их можно при помощи утилиты `deborphan`. Установим её:

    # apt-get install deborphan

Удалим ненужные библиотеки:

    # apt-get purge -y `deborphan`

Команду можно повторить несколько раз, до тех пор, пока `deborphan` не начнёт возвращать пустой список пакетов и пакеты не перестанут удаляться.

Кроме пакетов-библиотек в системе могут быть ненужные более пакеты, которые были установлены как зависимости, но пакет, использующий их, впоследствии был удалён:

    # apt-get autoremove -y

Наконец, даже если все ненужные пакеты были удалены из системы, от них могли остаться файлы конфигурации и каталоги с данными. Чтобы окончательно вычистить следы удалённых пакетов из системы, можно воспользоваться такой командой:

    # dpkg -l | awk '/^rc/ { print $2; }' | xargs apt-get purge -y

Очистка устаревших файлов конфигурации:

* [Cleaning up obsolete config files on Debian and Ubuntu](https://feeding.cloud.geek.nz/posts/cleaning-up-obsolete-config-files-debian-ubuntu/)
